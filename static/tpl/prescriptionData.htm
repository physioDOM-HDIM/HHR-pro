{% extends './page.htm' %}
{% block title %}{{title}}{% endblock %}
{% block head %}
{% parent %}
<script src="/bower_components/mustache/mustache.js"></script>
<script src="/bower_components/rsvp/rsvp.min.js"></script>
<script src="/bower_components/momentjs/min/moment-with-locales.min.js"></script>
<script src="/bower_components/zdk-calendar/form2js.js"></script>
<script src="/scripts/utils.js"></script>
<script src="/scripts/modal.js"></script>
<script src="/tpl/prescriptionData.js"></script>

<link rel="import" href="/bower_components/zdk-calendar/zdk-input-date.html">
<link rel="stylesheet" href="/styles/prescriptionData.css">
{% endblock %}

{% block content %}

<div class="hidden" id="lang">{{ lang }}</div>
<div class="hidden param-category">{{ category }}</div>
<div class="hidden param-list">{{ parameterList }}</div>
<div class="row title">
    <label class="title">
        {{title}}
    </label>
</div>

<div class="dataprog-list">
</div>

<div class="row control">
	<span class="spacer"></span>
	<button type="button" class="blue" onclick="showForm()">Add</button>
</div>

<zdk-modal id="editModal" closebutton="false">
	<form name="dataprog" id="dataprog-form">

	</form>
</zdk-modal>

<script type="template" id="tpl-dataprog">
	{% raw %}
	{{#param}}
	<div class="row">
		<div class="col05 bold data-text">{{labelLang}}</div>
		<!--
		<div class="col">
			<label>Min Threshold</label><span class="data-min">{{#threshold}}{{min}}{{/threshold}}</span>
		</div>
		<div class="col">
			<label>Max Threshold</label><span class="data-max">{{#threshold}}{{max}}{{/threshold}}</span>
		</div>
		-->
	</div>
	{{/param}}
	{% endraw %}
	<div class="row">
		<div class="col05"></div>
		<div class="col">
			<label>{{"Start date"|i18n}}</label><span>{% raw %}{{ data.startDate }}{% endraw %}</span>
		</div>
		<div class="col">
			<label>{{"End date"|i18n}}</label><span>{% raw %}{{ data.endDate }}{% endraw %}</span>
		</div>
	</div>

	<div class="row">
		<div class="col05"></div>
		<div class="col">
			<label>
				{% raw %}{{#data.hasDetail}}{% endraw %}
					{{"Every"|i18n}} {% raw %}{{data.repeat}} {{data.frequencyType}}{% endraw %}
				{% raw %}{{/data.hasDetail}}{% endraw %}
				{% raw %}{{^data.hasDetail}}{% endraw %}
					{{"Everyday"|i18n}}
				{% raw %}{{/data.hasDetail}}{% endraw %}
			</label>
			{% raw %}
			<ul class="data-list">
			{{#data}}
				{{#when}}
					{{#days}}
						<li>{{#getDay}}{{.}}{{/getDay}}</li>
					{{/days}}
				{{/when}}
			{{/data}}
			</ul>
			{% endraw %}
		</div>
		<div class="col"></div>
	</div>
	
	{% raw %}{{#data.hasMoreDetail}}{% endraw %}
	<div class="row">
		<div class="col05"></div>
		<div class="col">
			{{"The"|i18n}} {% raw %}{{data.when.weekNumber}}{% endraw %} {{"week from the"|i18n}} {% raw %}{{data.when.order}}{% endraw %} {{"of the month"|i18n}}
		</div>
		<!-- <div class="col"></div> -->
	</div>
	{% raw %}{{/data.hasMoreDetail}}{% endraw %}
	
	<div class="row control">
		<span class="spacer"></span>
		<button type="button" onclick="showForm('{% raw %}{{data.ref}}{% endraw %}')" class="small blue">{{"Edit"|i18n}}</button>
	</div>

	<hr>
</script>

<script type="template" id="tpl-form">
	<h2>{{title}}</h2>
	
	<div class="row">
		<label>{{"Type of data"|i18n}}</label>

		<select name="ref" onchange="updateParam(this)" id="ref-select">
			{% raw %}
			{{#paramList}}
			<option value="{{ref}}" {{#selection}}{{ref}}{{/selection}}>{{labelLang}}</option>
			{{/paramList}}
			{% endraw %}
		</select>

	</div>

	<div class="row">
		<div class="col vert">
			<label>{{"Start date"|i18n}}</label>
			<zdk-input-date name="startDate" value="{% raw %}{{data.startDate}}{% endraw %}" style="z-index:100" required></zdk-input-date>
		</div>
		<div class="col vert">
			<label>{{"End date"|i18n}}</label>
			<zdk-input-date name="endDate" value="{% raw %}{{data.endDate}}{% endraw %}" style="z-index:100"></zdk-input-date>
		</div>
	</div>

	<div class="row">
		<label>{{"Frequency"|i18n}}</label>
	</div>

	<div class="row frequency-choice">
		<input type="radio" name="frequency" onchange="showOptions('monthly')" value="monthly" 
		       {% raw %}{{#getFrequencyDefault}}monthly{{/getFrequencyDefault}}{% endraw %}><label>{{"Monthly"|i18n}}</label>
		<input type="radio" name="frequency" onchange="showOptions('weekly')" value="weekly" 
		       {% raw %}{{#getFrequencyDefault}}weekly{{/getFrequencyDefault}}{% endraw %}><label>{{"Weekly"|i18n}}</label>
		<input type="radio" name="frequency" onchange="showOptions('daily')" value="daily" 
		       {% raw %}{{#getFrequencyDefault}}daily{{/getFrequencyDefault}}{% endraw %}><label>{{"Daily"|i18n}}</label>
	</div>

	<div class="frequency-options"></div>

	<hr>


	<div class="row control">
		<span class="spacer"></span>
		<button type="button" onclick="closeForm()" class="red">{{"Cancel"|i18n}}</button>
		<button type="button" onclick="removeData('{{data._id}}')" class="red">{{"Delete"|i18n}}</button>
		<button type="button" onclick="saveData()" class="green">{{"Save"|i18n}}</button>
	</div>
	
</script>

<script type="template" id="tpl-option-weekly">

	<div class="row">
		{{"Every"|i18n}} <input type="number" name="repeat" class="option-repeat" value="{% raw %}{{data.repeat}}{% endraw %}"> {{"Week"|i18n}}
	</div>
	<div class="row">
		<input type="checkbox" name="when.days[]" value="1" {% raw %}{{#getDaysDefault}}1{{/getDaysDefault}}{% endraw %}/>{{"Mon"|i18n}}
		<input type="checkbox" name="when.days[]" value="2" {% raw %}{{#getDaysDefault}}2{{/getDaysDefault}}{% endraw %}/>{{"Tue"|i18n}}
		<input type="checkbox" name="when.days[]" value="3" {% raw %}{{#getDaysDefault}}3{{/getDaysDefault}}{% endraw %}/>{{"Wed"|i18n}}
		<input type="checkbox" name="when.days[]" value="4" {% raw %}{{#getDaysDefault}}4{{/getDaysDefault}}{% endraw %}/>{{"Thu"|i18n}}
		<input type="checkbox" name="when.days[]" value="5" {% raw %}{{#getDaysDefault}}5{{/getDaysDefault}}{% endraw %}/>{{"Fri"|i18n}}
		<input type="checkbox" name="when.days[]" value="6" {% raw %}{{#getDaysDefault}}6{{/getDaysDefault}}{% endraw %}/>{{"Sat"|i18n}}
		<input type="checkbox" name="when.days[]" value="0" {% raw %}{{#getDaysDefault}}0{{/getDaysDefault}}{% endraw %}/>{{"Sun"|i18n}}
	</div>

</script>

<script type="template" id="tpl-option-monthly">

	<div class="row">
		{{"Every"|i18n}} <input type="number" name="repeat" class="option-repeat" value="{% raw %}{{data.repeat}}{% endraw %}"> {{"Month"|i18n}}
	</div>
	<div class="row">
		The <select name="when.week" class="spacing-around">
			<option value="1" {% raw %}{{#getWeekDefault}}1{{/getWeekDefault}}{% endraw %}>{{"first"|i18n}}</option>
			<option value="2" {% raw %}{{#getWeekDefault}}2{{/getWeekDefault}}{% endraw %}>{{"second"|i18n}}</option>
			<option value="3" {% raw %}{{#getWeekDefault}}3{{/getWeekDefault}}{% endraw %}>{{"third"|i18n}}</option>
			<option value="4" {% raw %}{{#getWeekDefault}}4{{/getWeekDefault}}{% endraw %}>{{"fourth"|i18n}}</option>
		</select> week
	</div>
	<div class="row">
		{{"from the"|i18n}} <select name="when.order" class="spacing-around">
			<option value="1"  {% raw %}{{#getStartDefault}}1{{/getStartDefault}}{% endraw %}>{{"beginning"|i18n}}</option>
			<option value="-1" {% raw %}{{#getStartDefault}}-1{{/getStartDefault}}{% endraw %}>{{"end"|i18n}}</option>
		</select> {{"of the month"|i18n}}
	</div>
	<div class="row">
		<input type="checkbox" name="when.days[]" value="1" {% raw %}{{#getDaysDefault}}1{{/getDaysDefault}}{% endraw %}/>{{"Mon"|i18n}}
		<input type="checkbox" name="when.days[]" value="2" {% raw %}{{#getDaysDefault}}2{{/getDaysDefault}}{% endraw %}/>{{"Tue"|i18n}}
		<input type="checkbox" name="when.days[]" value="3" {% raw %}{{#getDaysDefault}}3{{/getDaysDefault}}{% endraw %}/>{{"Wed"|i18n}}
		<input type="checkbox" name="when.days[]" value="4" {% raw %}{{#getDaysDefault}}4{{/getDaysDefault}}{% endraw %}/>{{"Thu"|i18n}}
		<input type="checkbox" name="when.days[]" value="5" {% raw %}{{#getDaysDefault}}5{{/getDaysDefault}}{% endraw %}/>{{"Fri"|i18n}}
		<input type="checkbox" name="when.days[]" value="6" {% raw %}{{#getDaysDefault}}6{{/getDaysDefault}}{% endraw %}/>{{"Sat"|i18n}}
		<input type="checkbox" name="when.days[]" value="0" {% raw %}{{#getDaysDefault}}0{{/getDaysDefault}}{% endraw %}/>{{"Sun"|i18n}}
	</div>

</script>


{% include "./modal.htm" %}
{% endblock %}

