{% extends './page.htm' %}

{% block title %}{{ "Questionnaire overview"|i18n }}{% endblock %}

{% block head %}
{% parent %}
<script src="/bower_components/rsvp/rsvp.min.js"></script>
<script src="/bower_components/form2js/src/form2js.js"></script>
<script src="/tpl/questionnaireOverview.js"></script>
{% endblock %}
{% block content %}

<style>
	div.row label{
		width: 350px;
	}

	.space{
		width: 20%;
		margin: 30px auto;
		border-color: black;
	}
</style>

{% macro tpl(q, idx, subIdx) %}
	{% if q.header %}
		<div class="bold">{{idx}}{%if subIdx%}.{{subIdx}}{%endif%} - {{q.header}}</div>
		<input type="hidden" name="answers[{{idx}}].subscore" value="{{q.subscore}}" />
		<hr>
		{% for subQ in q.questions %}
			{{tpl(subQ, idx, loop.index)}}
		{% endfor %}
	{% else %}
		<div class="row">
			<div>{{idx}}{%if subIdx%}.{{subIdx}}{%endif%} - {{q.text}}</div>
		</div>
		<br/>
	{% endif %}
	{% for c in q.choice %}
		<div class="row">
			<label for="{%if subIdx%}answers[{{idx}}].choices[{{subIdx}}]{%else%}answers[{{idx}}]{%endif%}">{{c.text}}</label>
			<input type="radio" name="{%if subIdx%}answers[{{idx}}].choices[{{subIdx}}]{%else%}answers[{{idx}}]{%endif%}" value="{{c.value}}" required />
		</div>
		{% if loop.last %}
			<br/>
		{% endif %}
	{% endfor %}
{% endmacro %}

<div class="mainContainer">
	<h2>{{questionnaire.text}}</h2>
	<form autocomplete="off" name="questionnaire" onsubmit="checkForm(); return false;">
		{% for q in questionnaire.questions %}
			<div class="itemContainer">
				{{tpl(q, loop.index)}}
			</div>
			{% if !loop.last %}
				<hr class="space">
			{% endif %}
		{% endfor%}
		<div class="row control">
			<span class="spacer"></span>
			<button class="green">Validate</button>
		</div>
	</form>
	<zdk-modal id="statusModal" closebutton="false">
	    <div class="modalContainer">
	        <div class="modalTitleContainer"></div>
	        <div class="modalContentContainer"></div>
	        <div class="modalButtonContainer"></div>
	    </div>
	</zdk-modal>
	<div class="hidden">
	    <div id="trad_result">{{ "Result"|i18n }}</div>
	    <div id="trad_success_result">{{ "Your score is: "|i18n }}</div>
	    <div id="trad_ok">{{ "OK"|i18n }}</div>
	</div>
</div>
{% endblock %}
