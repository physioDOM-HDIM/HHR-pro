{% extends './page.htm' %}

{% block title %}{{ "Select beneficiary"|i18n }}{% endblock %}

{% block head %}
{% parent %}
  
<script src="/bower_components/form2js/src/form2js.js"></script>
<script src="/tpl/beneficiaries.js"></script>
{% endblock %}

{% block content %}
	<zdk-panel heading="{{'Filter'|i18n}} / {{'Sort'|i18n}}" collapsable="true" collapsed={% if admin %}"false"{% else %}"true"{% endif %}>
		<form class="filter" name="filter" autocomplete="off" onsubmit="validFilter(); return false;">
			<div>
				<div class="row">
					<div class="col">
						<label class="collabel" for="lastname">{{ "Last name"|i18n }} : </label>
						<div class="colcontent">
							<input type="text" name="name" id="lastname">
						</div>
					</div>
					<div class="col">
						<label class="collabel" for="Perimeter">{{ "Perimeter"|i18n }} : </label>
						<div class="colcontent">
						<select name="perimeter" id="Perimeter">
							{% for item in perimeter.items %}
							<option value="{{item.value}}" >{{item.label}}</option>
							{% endfor %}
						</select>
						</div>
					</div>
				</div>
				<div class="row">
					<div class="col">
						<label class="collabel" for="zipcode">{{ "Zip code"|i18n }} : </label>
						<div class="colcontent">
							<input type="text" name="zip" id="zipcode">
						</div>
					</div>
					<div class="col">
						<label class="collabel" for="city">{{ "City"|i18n }} : </label>
						<div class="colcontent">
							<input type="text" name="city" id="city">
						</div>
					</div>
				</div>
				<div style="height:10px">&nbsp;</div>
				<hr/>
				<div class="row">
					<div class="col">
						<label>Sort:</label>
						<select name="sort">
							<option value="name.family">name</option>
							<option value="perimeter">perimeter</option>
							<option value="address.zip">zip code</option>
							<option value="address.city">city</option>
						</select>
					</div>
					<div class="col">
						<label>Direction:</label>
						<select name="dir">
							<option value="1">ascending</option>
							<option value="-1">descending</option>
						</select>
					</div>
				</div>
				<div class="row control">
					<span class="spacer"></span>
					<button type="button" class="red" onclick="resetFilter()">Reset</button>
					<button class="green">Valid</button>
				</div>
			</div>
		</form>
	</zdk-panel>
	
	<tsante-list url="/api/beneficiaries" pg="1" auto="true" unresolved id="tsanteList">
		<template is="auto-binding" repeat="{% raw %}{{item in list.items}}{% endraw %}">
			<div class="item">
				<div class="row">
					<div style="-webkit-flex:1; -ms-flex:1; flex:1">
						<div class="row">
							<span style="-webkit-flex:2; -ms-flex:2; flex:2;font-weight:bold">{% raw %}{{item.name.family}} {{item.name.given}}{% endraw %}</span>
							<span style="-webkit-flex:1; -ms-flex:1; flex:1">{{ "Perimeter"|i18n }} : {% raw %}{{item.perimeter?item.perimeter:"-"}}{% endraw %}</span>
						</div>
						<div class="row">
							<span style="padding-left:50px;-webkit-flex:1; -ms-flex:1; flex:1">{{ "Birth date"|i18n }} : {% raw %}{{item.birthdate}}{% endraw %}</span>
						</div>
					</div>
					<div>
						{% if rights.write %}
						<a href="/beneficiary/edit/{%raw%}{{item._id}}{% endraw %}"><button class="blue small" style="margin:5px">edit</button></a>
						{% endif %}
						<a href="/beneficiary/{%raw%}{{item._id}}{% endraw %}"><button class="blue small" style="margin:5px">select</button></a>
					</div>
				</div>
			</div>
		</template>
	</tsante-list>
	
	{% if rights.write %}
	<div class="row control" style="height:60px; align-content: center">
		<span class="spacer"></span>
		<a href="/beneficiary/create"><button class="blue big">{{ "Add"|i18n }}</button></a>
	</div>
	{% endif %}
	{% if beneficiary && beneficiary.name %}
	<script>
		parent.document.querySelector("#beneficiary a").innerHTML = '{{ beneficiary.name.family }} {{ beneficiary.name.given }}';
		parent.highlight("/beneficiaries");
	</script>
	{% endif %}
{% endblock %}