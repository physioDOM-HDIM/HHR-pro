{% extends './page.htm' %}
  
{% block title %}{{ "Lists management"|i18n }}{% endblock %}

{% block head %}
{% parent %}
<script src="/bower_components/mustache/mustache.js"></script>
<script src="/bower_components/form2js/src/form2js.js"></script>
<script src="/bower_components/rsvp/rsvp.min.js"></script>
<link rel="stylesheet" href="/styles/listsManager.css" charset="UTF-8" />
<script src="/tpl/listsManager.js"></script>
{% endblock %}
  
{% block content %}
<script type="template" id="tplItemBasicContainer">
    <div class="row">
        <div class="col">
            <label>{{ "Active"|i18n }}:</label>
            <input type="checkbox" name="items[{% raw %}{{idx}}{% endraw %}].active" value="true" />
        </div>
        <div class="col">
            <label>{{ "Reference"|i18n }}:</label>
            <input type="text" name="items[{% raw %}{{idx}}{% endraw %}].ref" onblur="refreshDefaultValue('{% raw %}{{listName}}{% endraw %}')"/>
        </div>
        <div class="col">
            <label>{{ "Value"|i18n }}:</label>
            <input type="text" name="items[{% raw %}{{idx}}{% endraw %}].label.{{lang}}" />
        </div>
        <div class="col {% raw %}{{classRoleTypeCode}}{% endraw %}">
            <label>{{ "Role type code"|i18n }}:</label>
            <select name="items[{% raw %}{{idx}}{% endraw %}].roleTypeCode" multiple>
                {% for codeItem in job.items %}
                    <option value="{{codeItem.value}}" >{{codeItem.label}}</option>
                {% endfor %}
            </select>
        </div>
        <div class="col itemBtnContainer">
            <button type="button" class="small red" onclick="deleteItem(this)">{{ "Delete"|i18n }}</button>
        </div>
    </div>
</script>

<script type="template" id="tplItemMeasurableContainer">
    <div class="row">
        <div class="col">
            <label>{{ "Active"|i18n }}:</label>
            <input type="checkbox" name="items[{% raw %}{{idx}}{% endraw %}].active" value="true" />
        </div>
        <div class="col">
            <label>{{ "Reference"|i18n }}:</label>
            <input type="text" name="items[{% raw %}{{idx}}{% endraw %}].ref" onblur="refreshDefaultValue('{% raw %}{{listName}}{% endraw %}')"/>
        </div>
        <div class="col">
            <label>{{ "Value"|i18n }}:</label>
            <input type="text" name="items[{% raw %}{{idx}}{% endraw %}].label.{{lang}}" />
        </div>
        <div class="col">
            <!-- empty for the stylling -->
        </div>
    </div>
    <div class="row">
        <div class="col">
            <label>{{ "Unity"|i18n }}:</label>
            <select name="items[{% raw %}{{idx}}{% endraw %}].unity">
                {% for unityItem in unity.items %}
                    <option value="{{unityItem.value}}" >{{unityItem.label}}</option>
                {% endfor %}
            </select>
        </div>
        <div class="col">
            <label>{{ "AutoInput"|i18n }}:</label>
            <input type="checkbox" name="items[{% raw %}{{idx}}{% endraw %}].autoInput" value="true" />
        </div>
    </div>
    <div class="row">
        <div class="col">
            <label>{{ "Threshold Min"|i18n }}:</label>
            <input type="text" name="items[{% raw %}{{idx}}{% endraw %}].threshold.min" />
        </div>
        <div class="col">
            <label>{{ "Threshold Max"|i18n }}:</label>
            <input type="text" name="items[{% raw %}{{idx}}{% endraw %}].threshold.max" />
        </div>
        <div class="col">
            <label>{{ "Range Min"|i18n }}:</label>
            <input type="text" name="items[{% raw %}{{idx}}{% endraw %}].range.min" />
        </div>
        <div class="col">
            <label>{{ "Range Max"|i18n }}:</label>
            <input type="text" name="items[{% raw %}{{idx}}{% endraw %}].range.max" />
        </div>
        <div class="col">
            <!-- empty for the stylling -->
        </div>
    </div>
    <div class="row control itemBtnContainer">
        <span class="spacer"></span>
        <button type="button" class="red" onclick="deleteItem(this)">{{ "Delete"|i18n }}</button>
    </div>
</script>

<div class="mainContainer">
    <div class="listContainer">
        {% for list in lists.items %}
        <zdk-panel bgcolor="{% if !list.editable %} silver {% else %} gray {% endif %}" heading="{{list.name}}" collapsable="true" collapsed="true">
            <form name="{{list.name}}" autocomplete="off" onsubmit="checkForm(this); return false;">
                <input type="hidden" name="_id" value="{{list._id.toString()}}"/>
                <input type="hidden" name="name" value="{{list.name}}"/>
                <input type="hidden" name="editable" value="{{list.editable}}"/>
                {% if list.editable %}
                    <div class="row">
                        <label>{{ "Editable"|i18n }}:</label>
                        <input type="checkbox" name="editable" value="true" checked onclick="edit(this)"/>
                    </div>
                {% endif %}
                <div class="row">
                    <label>{{ "Default value"|i18n }}:</label>
                    <select name="defaultValue" {% if !list.editable %}disabled{% endif%}>
                        <option value="null" {% if list.defaultValue === null %}selected{% endif %}>{{ "-- No default value --"|i18n }}</option>
                        {% for item in list.items %}
                        <option value="{{item.ref}}" {% if list.defaultValue === item.ref %}selected{% endif %}>{{item.label[lang]}}</option>
                        {% endfor %}
                    </select>
                </div>
                <p>Items:</p>
                {% for item in list.items %}
                    <div class="itemContainer">
                        <div class="row">
                            <div class="col">
                                <label>{{ "Active"|i18n }}:</label>
                                <input type="checkbox" name="items[{{loop.index}}].active" value="true" {% if item.active %}checked{% endif %} {% if !list.editable %}disabled{% endif%}/>
                            </div>
                            <div class="col">
                                <label>{{ "Reference"|i18n }}:</label>
                                <input type="text" name="items[{{loop.index}}].ref" value="{{item.ref}}" onblur="refreshDefaultValue('{{list.name}}')" {% if !list.editable %}disabled{% endif%}/>
                            </div>
                            <div class="col">
                                <label>{{ "Value"|i18n }}:</label>
                                <input type="text" name="items[{{loop.index}}].label.{{lang}}" value="{{item.label[lang]}}" {% if !list.editable %}disabled{% endif%} />
                            </div>
                            {% if item.roleTypeCode.length %}
                                <div class="col">
                                    <label>{{ "Role type code"|i18n }}:</label>
                                    <select name="items[{{loop.index}}].roleTypeCode" {% if !list.editable %}disabled{% endif%} multiple>
                                        {% for codeItem in job.items %}
                                            {% set selectIt = false %}
                                            {% for roleTypeCodeItem in item.roleTypeCode %}
                                                {% if roleTypeCodeItem === codeItem.value %}
                                                    {% set selectIt = true %}
                                                {% endif %}
                                            {% endfor %}
                                            <option value="{{codeItem.value}}" {% if selectIt %}selected{% endif %}>{{codeItem.label}}</option>
                                        {% endfor %}
                                    </select>
                                </div>
                            {% endif %}
                            {% if item.autoInput === true || item.autoInput === false %}
                                 <div class="col">
                                    <!-- empty for the stylling -->
                                </div>
                            </div>
                            <div class="row">
                                <div class="col">
                                    <label>{{ "Unity"|i18n }}:</label>
                                    <select name="items[{{loop.index}}].unity" {% if !list.editable %}disabled{% endif%}>
                                        {% for unityItem in unity.items %}
                                            <option value="{{unityItem.value}}" {% if item.unity === unityItem.value %}selected{% endif %}>{{unityItem.label}}</option>
                                        {% endfor %}
                                    </select>
                                </div>
                                <div class="col">
                                    <label>{{ "AutoInput"|i18n }}:</label>
                                    <input type="checkbox" name="items[{{loop.index}}].autoInput" value="true" {% if !list.editable %}disabled{% endif%} {% if item.autoInput %}checked{% endif%}/>
                                </div>
                            </div>
                            <div class="row">
                                <div class="col">
                                    <label>{{ "Threshold Min"|i18n }}:</label>
                                    <input type="text" name="items[{{loop.index}}].threshold.min" value="{{item.threshold.min}}" {% if !list.editable %}disabled{% endif%} />
                                </div>
                                <div class="col">
                                    <label>{{ "Threshold Max"|i18n }}:</label>
                                    <input type="text" name="items[{{loop.index}}].threshold.max" value="{{item.threshold.max}}" {% if !list.editable %}disabled{% endif%} />
                                </div>
                                <div class="col">
                                    <label>{{ "Range Min"|i18n }}:</label>
                                    <input type="text" name="items[{{loop.index}}].range.min" value="{{item.range.min}}" {% if !list.editable %}disabled{% endif%} />
                                </div>
                                <div class="col">
                                    <label>{{ "Range Max"|i18n }}:</label>
                                    <input type="text" name="items[{{loop.index}}].range.max" value="{{item.range.max}}" {% if !list.editable %}disabled{% endif%} />
                                </div>
                            {% endif %}
                            <div class="col">
                                <!-- empty for the stylling -->
                            </div>
                        </div>
                    </div>
                {% endfor %}
                {% if list.editable %}
                    <div class="row control mainBtnContainer">
                        <span class="spacer"></span>
                        <button type="button" class="blue" onclick="addItem(this)">{{ "Add"|i18n }}</button>
                        <button class="blue">{{ "Save"|i18n }}</button>
                    </div>
                {% endif %}
            </form>
        </zdk-panel>
        {% endfor%}
    </div>
</div>
<zdk-modal id="statusModal" closebutton="false">
    <div class="modalContainer">
        <div class="modalTitleContainer"></div>
        <div class="modalContentContainer"></div>
        <div class="modalButtonContainer"></div>
    </div>
</zdk-modal>
<div class="hidden">
    <div id="trad_save">{{ "Save"|i18n }}</div>
    <div id="trad_success">{{ "Success"|i18n }}</div>
    <div id="trad_error">{{ "Error"|i18n }}</div>
    <div id="trad_confirm_save">{{ "Are you sure you want to save this part ?"|i18n }}</div>
    <div id="trad_success_update">{{ "Item successfully updated"|i18n }}</div>
    <div id="trad_error_occured">{{ "An error occured"|i18n }}</div>
    <div id="trad_error_ref">{{ "Some values already exists"|i18n }}</div>
    <div id="trad_yes">{{ "Yes"|i18n }}</div>
    <div id="trad_no">{{ "No"|i18n }}</div>
    <div id="trad_ok">{{ "OK"|i18n }}</div>
</div>
{% endblock %}
